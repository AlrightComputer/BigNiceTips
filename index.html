<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tip Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .calculator-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }

        .bill-input {
            margin-bottom: 30px;
        }

        .bill-input label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .bill-input input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            transition: border-color 0.3s ease;
        }

        .bill-input input:focus {
            outline: none;
            border-color: #667eea;
        }

        .tip-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .tip-button {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tip-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .tip-button.selected {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
            color: white;
        }

        .tip-percentage {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .tip-button.selected .tip-percentage {
            color: white;
        }

        .tip-amount {
            font-size: 14px;
            color: #6c757d;
            font-weight: 500;
        }

        .tip-button.selected .tip-amount {
            color: rgba(255, 255, 255, 0.9);
        }

        .custom-tip, .no-tip {
            width: 100%;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
        }

        .custom-tip:hover, .no-tip:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .custom-tip.selected, .no-tip.selected {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
            color: white;
        }

        .custom-input {
            display: none;
            margin-top: 15px;
        }

        .custom-input.show {
            display: block;
        }

        .custom-input input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            text-align: center;
        }

        .total-section {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .total-section.pay-now {
            background: #1a1a1a;
            border: 2px solid #333;
        }

        .total-section.pay-now:hover {
            background: #2a2a2a;
            border-color: #444;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .payment-buttons {
            display: none;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .total-section.pay-now .payment-buttons {
            display: flex;
        }

        .apple-pay-button {
            background: #000;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .apple-pay-button:hover {
            background: #333;
        }

        .apple-pay-button:active {
            transform: scale(0.98);
        }

        .apple-pay-button.supported {
            background: linear-gradient(135deg, #000 0%, #333 100%);
        }

        .venmo-button {
            background: #3D95CE;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .venmo-button:hover {
            background: #2980b9;
        }

        .venmo-button:active {
            transform: scale(0.98);
        }

        .payment-method-text {
            font-size: 12px;
            color: #888;
            margin-top: 10px;
            text-align: center;
        }

        .total-label {
            font-size: 16px;
            color: #6c757d;
            margin-bottom: 10px;
            display: block;
        }

        .total-section.pay-now .total-label {
            color: #b0b0b0;
            display: inline;
            margin-bottom: 0;
            margin-right: 10px;
        }

        .total-amount {
            font-size: 36px;
            font-weight: 700;
            color: #333;
        }

        .total-section.pay-now .total-amount {
            color: #e0e0e0;
            font-size: 18px;
            display: inline;
            font-weight: 600;
        }

        .tip-breakdown {
            margin-top: 15px;
            font-size: 14px;
            color: #6c757d;
        }

        .total-section.pay-now .tip-breakdown {
            color: #888;
            margin-top: 0;
        }

        .pay-now-text {
            display: none;
            font-size: 24px;
            font-weight: 700;
            color: #e0e0e0;
            margin-top: 15px;
            margin-bottom: 10px;
        }

        .total-section.pay-now .pay-now-text {
            display: block;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="bill-input">
            <label for="billAmount">Bill Amount</label>
            <input type="number" id="billAmount" placeholder="$0.00" step="0.01" min="0">
        </div>

        <div class="tip-options">
            <div class="tip-button" data-tip="15">
                <div class="tip-percentage">15%</div>
                <div class="tip-amount">$0.00</div>
            </div>
            <div class="tip-button" data-tip="20">
                <div class="tip-percentage">20%</div>
                <div class="tip-amount">$0.00</div>
            </div>
            <div class="tip-button" data-tip="25">
                <div class="tip-percentage">25%</div>
                <div class="tip-amount">$0.00</div>
            </div>
        </div>

        <div class="custom-tip" id="customTip">
            Custom Tip Amount
            <div class="custom-input" id="customInput">
                <input type="number" id="customAmount" placeholder="Enter custom tip %" step="0.1" min="0">
            </div>
        </div>

        <div class="no-tip" id="noTip">
            No Tip
        </div>

        <div class="total-section" id="totalSection">
            <div class="total-label">Total Amount</div>
            <div class="total-amount" id="totalAmount">$0.00</div>
            <div class="pay-now-text">Pay Now</div>
            <div class="tip-breakdown" id="tipBreakdown">Tip: $0.00</div>
            <div class="payment-buttons">
                <button class="apple-pay-button" id="applePayButton" style="display: none;">
                    <span>üçé</span> Pay with Apple Pay
                </button>
                <button class="venmo-button" id="venmoButton">
                    Pay with Venmo
                </button>
                <div class="payment-method-text" id="paymentMethodText"></div>
            </div>
        </div>
    </div>

    <script>
        let billAmount = 0;
        let selectedTip = 0;
        let customTipValue = 0;
        let hasTipSelection = false;
        let isApplePaySupported = false;

        const billInput = document.getElementById('billAmount');
        const tipButtons = document.querySelectorAll('.tip-button');
        const customTipButton = document.getElementById('customTip');
        const customInput = document.getElementById('customInput');
        const customAmountInput = document.getElementById('customAmount');
        const noTipButton = document.getElementById('noTip');
        const totalAmountDisplay = document.getElementById('totalAmount');
        const tipBreakdownDisplay = document.getElementById('tipBreakdown');
        const totalSection = document.getElementById('totalSection');
        const applePayButton = document.getElementById('applePayButton');
        const venmoButton = document.getElementById('venmoButton');
        const paymentMethodText = document.getElementById('paymentMethodText');

        // Your Venmo username - replace with actual username
        const VENMO_USERNAME = 'LanaDelRey'; // Update this with your actual Venmo username

        function checkApplePaySupport() {
            if (window.ApplePaySession) {
                const merchantCapabilities = ['supports3DS'];
                const supportedNetworks = ['visa', 'masterCard', 'amex', 'discover'];
                
                if (ApplePaySession.canMakePaymentsWithActiveCard) {
                    ApplePaySession.canMakePaymentsWithActiveCard('merchant.com.yourstore').then((canMakePayments) => {
                        isApplePaySupported = canMakePayments;
                        updatePaymentInterface();
                    }).catch(() => {
                        // Check if Apple Pay is available at all
                        isApplePaySupported = ApplePaySession.canMakePayments();
                        updatePaymentInterface();
                    });
                } else {
                    isApplePaySupported = ApplePaySession.canMakePayments();
                    updatePaymentInterface();
                }
            } else {
                isApplePaySupported = false;
                updatePaymentInterface();
            }
        }

        function updatePaymentInterface() {
            if (isApplePaySupported) {
                applePayButton.style.display = 'flex';
                venmoButton.style.display = 'flex';
                paymentMethodText.textContent = 'Apple Pay or Venmo accepted';
            } else {
                applePayButton.style.display = 'none';
                venmoButton.style.display = 'flex';
                paymentMethodText.textContent = 'Pay with Venmo';
            }
        }

        function processApplePay() {
            if (!window.ApplePaySession) {
                alert('Apple Pay is not supported on this device/browser');
                return;
            }

            const total = billAmount + (billAmount * (selectedTip || customTipValue) / 100);
            
            const request = {
                countryCode: 'US',
                currencyCode: 'USD',
                supportedNetworks: ['visa', 'masterCard', 'amex', 'discover'],
                merchantCapabilities: ['supports3DS'],
                total: {
                    label: 'Tip Calculator Payment',
                    amount: total.toFixed(2)
                }
            };

            const session = new ApplePaySession(3, request);

            session.onvalidatemerchant = (event) => {
                // In a real implementation, you'd validate with your server
                console.log('Apple Pay merchant validation required');
                // For demo purposes, we'll simulate validation
                setTimeout(() => {
                    try {
                        session.completeMerchantValidation({});
                    } catch (e) {
                        session.abort();
                        processVenmoPayment(); // Fallback to Venmo
                    }
                }, 1000);
            };

            session.onpaymentauthorized = (event) => {
                // Process the payment token with your payment processor
                console.log('Apple Pay authorized:', event.payment);
                
                // Simulate payment processing
                setTimeout(() => {
                    session.completePayment(ApplePaySession.STATUS_SUCCESS);
                    showPaymentSuccess('Apple Pay');
                }, 1500);
            };

            session.oncancel = () => {
                console.log('Apple Pay cancelled');
            };

            try {
                session.begin();
            } catch (e) {
                console.log('Apple Pay session failed to start, falling back to Venmo');
                processVenmoPayment();
            }
        }

        function processVenmoPayment() {
            const total = billAmount + (billAmount * (selectedTip || customTipValue) / 100);
            const tipPercent = selectedTip || customTipValue || 0;
            const note = `Tip Calculator Payment - ${billAmount.toFixed(2)} + ${tipPercent}% tip`;
            
            // Create Venmo payment URL
            const venmoUrl = `venmo://paycharge?txn=pay&recipients=${VENMO_USERNAME}&amount=${total.toFixed(2)}&note=${encodeURIComponent(note)}`;
            const venmoWebUrl = `https://venmo.com/code?user_id=${VENMO_USERNAME}&amount=${total.toFixed(2)}&note=${encodeURIComponent(note)}`;
            
            // Try to open Venmo app first, fallback to web
            const userAgent = navigator.userAgent.toLowerCase();
            const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
            
            if (isMobile) {
                // Try to open Venmo app
                window.location.href = venmoUrl;
                
                // Fallback to web after a delay if app doesn't open
                setTimeout(() => {
                    if (!document.hidden) {
                        window.open(venmoWebUrl, '_blank');
                    }
                }, 2000);
            } else {
                // Desktop - open Venmo web interface
                window.open(venmoWebUrl, '_blank');
            }
            
            // Show payment initiated message
            showPaymentInitiated('Venmo');
        }

        function showPaymentSuccess(method) {
            alert(`Payment successful via ${method}! Thank you for your payment.`);
            // Reset calculator
            billInput.value = '';
            clearSelections();
            updateTipAmounts();
        }

        function showPaymentInitiated(method) {
            alert(`Payment initiated via ${method}. Please complete the payment in the ${method} app/website.`);
        }

        function updatePayNowState() {
            const hasAmount = billAmount > 0;
            let hasValidTip = false;
            
            // Check if we have a valid tip selection
            if (selectedTip > 0) {
                hasValidTip = true;
            } else if (noTipButton.classList.contains('selected')) {
                hasValidTip = true;
            } else if (customTipButton.classList.contains('selected') && customAmountInput.value !== '' && customTipValue >= 0) {
                hasValidTip = true;
            }
            
            if (hasAmount && hasValidTip) {
                totalSection.classList.add('pay-now');
            } else {
                totalSection.classList.remove('pay-now');
            }
        }

        function updateTipAmounts() {
            billAmount = parseFloat(billInput.value) || 0;
            
            tipButtons.forEach(button => {
                const tipPercent = parseInt(button.dataset.tip);
                const tipAmount = (billAmount * tipPercent) / 100;
                button.querySelector('.tip-amount').textContent = `${tipAmount.toFixed(2)}`;
            });
            
            calculateTotal();
            updatePayNowState();
        }

        function calculateTotal() {
            let tipAmount = 0;
            let tipPercent = 0;

            if (selectedTip > 0) {
                tipPercent = selectedTip;
                tipAmount = (billAmount * selectedTip) / 100;
            } else if (customTipValue > 0) {
                tipPercent = customTipValue;
                tipAmount = (billAmount * customTipValue) / 100;
            }

            const total = billAmount + tipAmount;
            totalAmountDisplay.textContent = `$${total.toFixed(2)}`;
            tipBreakdownDisplay.textContent = `Tip (${tipPercent}%): $${tipAmount.toFixed(2)}`;
        }

        function clearSelections() {
            tipButtons.forEach(btn => btn.classList.remove('selected'));
            customTipButton.classList.remove('selected');
            noTipButton.classList.remove('selected');
            customInput.classList.remove('show');
            selectedTip = 0;
            customTipValue = 0;
            hasTipSelection = false;
            updatePayNowState();
        }

        billInput.addEventListener('input', updateTipAmounts);

        tipButtons.forEach(button => {
            button.addEventListener('click', () => {
                clearSelections();
                button.classList.add('selected');
                selectedTip = parseInt(button.dataset.tip);
                hasTipSelection = true;
                calculateTotal();
                updatePayNowState();
            });
        });

        customTipButton.addEventListener('click', () => {
            clearSelections();
            customTipButton.classList.add('selected');
            customInput.classList.add('show');
            customAmountInput.focus();
            updatePayNowState();
        });

        customAmountInput.addEventListener('input', () => {
            customTipValue = parseFloat(customAmountInput.value) || 0;
            calculateTotal();
            updatePayNowState();
        });

        noTipButton.addEventListener('click', () => {
            clearSelections();
            noTipButton.classList.add('selected');
            hasTipSelection = true;
            calculateTotal();
            updatePayNowState();
        });

        // Initialize payment methods on load
        checkApplePaySupport();

        // Payment button event listeners
        applePayButton.addEventListener('click', processApplePay);
        venmoButton.addEventListener('click', processVenmoPayment);

        // Initialize
        updateTipAmounts();
    </script>
</body>
</html>
